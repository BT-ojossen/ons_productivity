<?xml version="1.0" encoding="utf-8"?>
<!--
  File: stats_view.xml
  Module: ons_productivity_stats

  Created by cyp@open-net.ch

  Copyright (c) 2013 Open-Net Ltd. All rights reserved.
-->
<openerp>
		<data>

			<!-- 
                Main entry for the statistics
            -->
			<menuitem
				name="Salespersons statistics"
                id="ons_stats_root_menu" 
				parent="account.menu_finance_reporting"/>

            <!--
                Report
            -->
<!--
            <report 
                auto="False" 
                id="report_webkit_ons_stats" 
                model="ons.stats" 
                name="report.webkit.ons_stats"
                file="ons_productivity_stats/report/report_webkit_stats.mako"
                string="Statistics"
                report_type="webkit"/>
-->
            <report 
                auto="False" 
                id="report_rml_ons_stats" 
                model="ons.stats" 
                name="rml.ons_stats"
                file="ons_productivity_stats/report/report_rml_stats.rml"
                string="Statistics"/>

			<!-- 
                Statistics: form
            -->
			<record model="ir.ui.view" id="ons_stats_form">
				<field name="name">ons.stats.tmpl.form</field>
				<field name="model">ons.stats</field>
				<field name="type">form</field>
				<field name="arch" type="xml">
                    <form string="Statistics">
                        <group col="2">
                            <field name="is_template" invisible="1"/>
                            <field name="name" attrs="{'readonly':[('is_template','=',False)]}"/>
                            <field name="company_id" attrs="{'readonly':[('is_template','=',False)]}"/>
                            <field name="comp_currency_id" readonly="1"/>
                            <group attrs="{'invisible':[('is_template','=',False)]}" colspan="2" col="2">
                                <separator string="Compl. currencies" colspan="2"/>
                                <field name="currency_ids" nolabel="1" colspan="2"/>
                            </group>
                            <group attrs="{'invisible':[('is_template','!=',False)]}" colspan="2" col="2">
                                <separator string="Period statistics" colspan="2"/>
                                <field name="main_line_ids" nolabel="1" colspan="2" mode="tree,form">
                                    <tree string=" ">
                                        <field name="currency_id"/>
                                        <field name="sale_stat"/>
                                        <field name="opened_inv_stat"/>
                                        <field name="void" string=" "/>
                                    </tree>
                                    <form string=" ">
                                        <field name="currency_id"/>
                                        <newline/>
                                        <group colspan="4" col="6">
                                            <field name="sale_stat"/>
                                            <field name="opened_inv_stat"/>
                                        </group>
                                    </form>
                                </field>
                            </group>
                        </group>
                        <group col="6">
                            <group colspan="4">
                                <field name="date_from" readonly="1" attrs="{'invisible':[('is_template','!=',False)]}"/>
                                <field name="date_to" readonly="1" attrs="{'invisible':[('is_template','!=',False)]}"/>
                                <newline/>
                            </group>
                            <group colspan="2">
                                <button name="%(on_wiz_gen_stats_action)d" string="Generate" type="action" icon="terp-camera_test" attrs="{'invisible':[('is_template','=',False)]}"/>
                                <button name="%(report_rml_ons_stats)d" string="Print" type="action" icon="terp-emblem-documents" attrs="{'invisible':[('is_template','!=',False)]}"/>
                            </group>
                            <field name="user_line_ids" nolabel="1" colspan="6" mode="tree,form" attrs="{'readonly':[('is_template','=',False)]}">
                                <tree editable="bottom" string="">
                                    <field name="name" attrs="{'readonly':[('is_template','=',False)]}"/>
                                    <field name="is_template" invisible="1"/>
                                </tree>
                                <form string="">
                                    <field name="name" attrs="{'readonly':[('is_template','=',False)]}"/>
                                    <field name="is_template" invisible="1"/>
                                    <group colspan="4" attrs="{'invisible':[('is_template','!=',False)]}">
                                        <field name="currency_line_ids" colspan="4" nolabel="1" mode="tree,form">
                                            <tree string=" ">
                                                <field name="name"/>
                                                <field name="sale_stat"/>
                                                <field name="opened_inv_stat"/>
                                            </tree>
                                            <form string=" ">
                                                <field name="name"/>
                                                <newline/>
                                                <group colspan="4" col="6">
                                                    <field name="sale_stat"/>
                                                    <field name="opened_inv_stat"/>
                                                </group>
                                            </form>
                                        </field>
                                    </group>
                                </form>
                            </field>
                        </group>
                        <group colspan="4" attrs="{'invisible':[('is_template','!=',False)]}">
                            <separator string="Sales" colspan="2"/>
                            <separator string="Invoices" colspan="2"/>
                            <field name="sale_ids" colspan="2" nolabel="1" readonly="1" mode="tree,view" height="300">
                                <tree string="" colors="red:so_is_too_old">
                                    <field name="date_order"/>
                                    <field name="name" string="Reference"/>
                                    <field name="user_id" select="1"/>
                                    <field name="partner_id"/>
                                    <field name="amount_untaxed" sum="Total"/>
                                    <field name="currency_id"/>
                                    <field name="so_is_too_old" invisible="1"/>
                                </tree>
                            </field>
                            <field name="invoice_ids" colspan="2" nolabel="1" readonly="1" mode="tree,view" height="300">
                                <tree string="" colors="blue:state in ('draft');black:state in ('proforma','proforma2','open');gray:state in ('cancel')">
                                    <field name="date_invoice"/>
                                    <field name="number"/>
                                    <field name="partner_id" groups="base.group_user"/>
                                    <field name="name"/>
                                    <field name="user_id"/>
                                    <field name="amount_untaxed" sum="Total"/>
                                    <field name="currency_id"/>
                                </tree>
                            </field>
                        </group>
                    </form>
				</field>
			</record>

			<!-- 
                Statistics: list
            -->
			<record model="ir.ui.view" id="ons_stats_list">
				<field name="name">ons.stats.tmpl.list</field>
				<field name="model">ons.stats</field>
				<field name="type">tree</field>
				<field name="arch" type="xml">
                    <tree string="Statistics">
                        <field name="name"/>
                        <field name="is_template" invisible="1"/>
                        <field name="date_from" attrs="{'invisible':[('is_template','!=',False)]}"/>
                        <field name="date_to" attrs="{'invisible':[('is_template','!=',False)]}"/>
                        <field name="sales_count" attrs="{'invisible':[('is_template','!=',False)]}"/>
                        <field name="invoices_count" attrs="{'invisible':[('is_template','!=',False)]}"/>
                        <field name="void" string=" "/>
                    </tree>
				</field>
			</record>

			<!-- 
                Template for statistics: access it
            -->
            <record model="ir.actions.act_window" id="ons_stats_tmpl_action">
                <field name="name">Templates</field>
                <field name="res_model">ons.stats</field>
                <field name="view_type">form</field>
                <field name="view_mode">tree,form</field>
                <field name="domain">[('is_template','!=',False)]</field>
            </record>
			<menuitem action="ons_stats_tmpl_action"
				id="ons_stats_tmpl_menu" 
				parent="ons_stats_root_menu"
                sequence="1"/>

			<!--
                List for statistics: access it
            -->
            <record model="ir.actions.act_window" id="ons_stats_list_action">
                <field name="name">Lists</field>
                <field name="res_model">ons.stats</field>
                <field name="view_type">form</field>
                <field name="view_mode">tree,form</field>
                <field name="domain">[('is_template','=',False)]</field>
            </record>
			<menuitem action="ons_stats_list_action"
				id="ons_stats_list_menu" 
				parent="ons_stats_root_menu"
                sequence="2"/>

		</data>
</openerp>
